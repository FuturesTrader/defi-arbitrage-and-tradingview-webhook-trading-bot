<svg viewBox="0 0 1400 1800" xmlns="http://www.w3.org/2000/svg">
  <!-- Define styles -->
  <defs>
    <style>
      .main-box { fill: #2563eb; stroke: #1e40af; stroke-width: 2; }
      .service-box { fill: #7c3aed; stroke: #6d28d9; stroke-width: 2; }
      .dex-box { fill: #059669; stroke: #047857; stroke-width: 2; }
      .contract-box { fill: #dc2626; stroke: #b91c1c; stroke-width: 2; }
      .flash-box { fill: #ea580c; stroke: #c2410c; stroke-width: 2; }
      .utils-box { fill: #0891b2; stroke: #0e7490; stroke-width: 2; }
      .data-box { fill: #64748b; stroke: #475569; stroke-width: 2; }
      .text-white { fill: white; font-family: Arial, sans-serif; font-size: 14px; font-weight: bold; }
      .text-small { fill: white; font-family: Arial, sans-serif; font-size: 12px; }
      .arrow { stroke: #334155; stroke-width: 2; fill: none; marker-end: url(#arrowhead); }
      .flash-arrow { stroke: #ea580c; stroke-width: 2; fill: none; marker-end: url(#flash-arrowhead); stroke-dasharray: 5,5; }
      .data-arrow { stroke: #64748b; stroke-width: 1; fill: none; marker-end: url(#data-arrowhead); stroke-dasharray: 3,3; }
      .legend-text { fill: #334155; font-family: Arial, sans-serif; font-size: 12px; }
    </style>
    
    <!-- Arrow markers -->
    <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#334155" />
    </marker>
    <marker id="flash-arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#ea580c" />
    </marker>
    <marker id="data-arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#64748b" />
    </marker>
  </defs>
  
  <!-- Title -->
  <text x="700" y="30" text-anchor="middle" style="font-size: 24px; font-weight: bold; fill: #1e293b;">
    Cross-DEX Arbitrage Bot with Balancer V2 Flash Loans
  </text>
  <text x="700" y="55" text-anchor="middle" style="font-size: 16px; fill: #475569;">
    Supporting USDC-WAVAX and USDC-WBTC Trading Pairs
  </text>
  
  <!-- Main Execution Layer -->
  <rect x="550" y="100" width="300" height="80" class="main-box" rx="5"/>
  <text x="700" y="130" text-anchor="middle" class="text-white">mainArbitrage.ts</text>
  <text x="700" y="150" text-anchor="middle" class="text-small">Main Execution Loop</text>
  <text x="700" y="165" text-anchor="middle" class="text-small">Metrics & Shutdown Handler</text>
  
  <!-- Core Services Layer -->
  <rect x="200" y="250" width="200" height="80" class="service-box" rx="5"/>
  <text x="300" y="280" text-anchor="middle" class="text-white">PriceMonitorService</text>
  <text x="300" y="300" text-anchor="middle" class="text-small">Find Opportunities</text>
  <text x="300" y="315" text-anchor="middle" class="text-small">Parallel Quotes</text>
  
  <rect x="450" y="250" width="200" height="80" class="service-box" rx="5"/>
  <text x="550" y="280" text-anchor="middle" class="text-white">ArbitrageService</text>
  <text x="550" y="300" text-anchor="middle" class="text-small">Execute Trades</text>
  <text x="550" y="315" text-anchor="middle" class="text-small">Gas Management</text>
  
  <rect x="700" y="250" width="200" height="80" class="service-box" rx="5"/>
  <text x="800" y="280" text-anchor="middle" class="text-white">SmartContractService</text>
  <text x="800" y="300" text-anchor="middle" class="text-small">Contract Interaction</text>
  <text x="800" y="315" text-anchor="middle" class="text-small">Event Parsing</text>
  
  <rect x="950" y="250" width="200" height="80" class="flash-box" rx="5"/>
  <text x="1050" y="280" text-anchor="middle" class="text-white">FlashLoanService</text>
  <text x="1050" y="300" text-anchor="middle" class="text-small">Balancer V2 Integration</text>
  <text x="1050" y="315" text-anchor="middle" class="text-small">0% Fee Flash Loans</text>
  
  <!-- DEX Quoter Layer -->
  <rect x="100" y="400" width="180" height="80" class="dex-box" rx="5"/>
  <text x="190" y="430" text-anchor="middle" class="text-white">quoterUniswap.ts</text>
  <text x="190" y="450" text-anchor="middle" class="text-small">Uniswap V3 Quotes</text>
  <text x="190" y="465" text-anchor="middle" class="text-small">USDC/WAVAX/WBTC</text>
  
  <rect x="320" y="400" width="180" height="80" class="dex-box" rx="5"/>
  <text x="410" y="430" text-anchor="middle" class="text-white">quoterTraderJoe.ts</text>
  <text x="410" y="450" text-anchor="middle" class="text-small">TraderJoe V2 Quotes</text>
  <text x="410" y="465" text-anchor="middle" class="text-small">USDC/WAVAX/WBTC</text>
  
  <!-- Smart Contract Layer -->
  <rect x="550" y="550" width="300" height="100" class="contract-box" rx="5"/>
  <text x="700" y="580" text-anchor="middle" class="text-white">CrossDexArbitrageWithFlashLoan.sol</text>
  <text x="700" y="600" text-anchor="middle" class="text-small">Atomic Swaps + Flash Loans</text>
  <text x="700" y="620" text-anchor="middle" class="text-small">Balancer V2 Callback Handler</text>
  <text x="700" y="635" text-anchor="middle" class="text-small">Multi-Token Support (WAVAX/WBTC)</text>
  
  <!-- Flash Loan Provider -->
  <rect x="950" y="550" width="200" height="80" class="flash-box" rx="5"/>
  <text x="1050" y="580" text-anchor="middle" class="text-white">Balancer V2 Vault</text>
  <text x="1050" y="600" text-anchor="middle" class="text-small">Flash Loan Provider</text>
  <text x="1050" y="615" text-anchor="middle" class="text-small">0% Fee Loans</text>
  
  <!-- DEX Protocols -->
  <rect x="350" y="720" width="180" height="80" class="dex-box" rx="5"/>
  <text x="440" y="750" text-anchor="middle" class="text-white">Uniswap V3</text>
  <text x="440" y="770" text-anchor="middle" class="text-small">Router & Pools</text>
  <text x="440" y="785" text-anchor="middle" class="text-small">exactInputSingle</text>
  
  <rect x="570" y="720" width="180" height="80" class="dex-box" rx="5"/>
  <text x="660" y="750" text-anchor="middle" class="text-white">TraderJoe V2</text>
  <text x="660" y="770" text-anchor="middle" class="text-small">LB Router</text>
  <text x="660" y="785" text-anchor="middle" class="text-small">swapExactTokensForTokens</text>
  
  <rect x="790" y="720" width="180" height="80" class="dex-box" rx="5"/>
  <text x="880" y="750" text-anchor="middle" class="text-white">Token Contracts</text>
  <text x="880" y="770" text-anchor="middle" class="text-small">USDC / WAVAX / WBTC</text>
  <text x="880" y="785" text-anchor="middle" class="text-small">ERC20 Operations</text>
  
  <!-- Utility Services -->
  <rect x="100" y="870" width="160" height="70" class="utils-box" rx="5"/>
  <text x="180" y="900" text-anchor="middle" class="text-white">GasUtility</text>
  <text x="180" y="920" text-anchor="middle" class="text-small">Gas Optimization</text>
  
  <rect x="290" y="870" width="160" height="70" class="utils-box" rx="5"/>
  <text x="370" y="900" text-anchor="middle" class="text-white">TimingUtility</text>
  <text x="370" y="920" text-anchor="middle" class="text-small">Performance Tracking</text>
  
  <rect x="480" y="870" width="160" height="70" class="utils-box" rx="5"/>
  <text x="560" y="900" text-anchor="middle" class="text-white">Logger</text>
  <text x="560" y="920" text-anchor="middle" class="text-small">Trade & Error Logs</text>
  
  <!-- Data Collection -->
  <rect x="700" y="870" width="180" height="70" class="data-box" rx="5"/>
  <text x="790" y="900" text-anchor="middle" class="text-white">TradeMetricsManager</text>
  <text x="790" y="920" text-anchor="middle" class="text-small">Performance Analytics</text>
  
  <rect x="920" y="870" width="180" height="70" class="data-box" rx="5"/>
  <text x="1010" y="900" text-anchor="middle" class="text-white">Data Collection</text>
  <text x="1010" y="920" text-anchor="middle" class="text-small">Quote Accuracy Analysis</text>
  
  <!-- Configuration -->
  <rect x="1150" y="870" width="180" height="70" class="data-box" rx="5"/>
  <text x="1240" y="900" text-anchor="middle" class="text-white">Constants & Config</text>
  <text x="1240" y="920" text-anchor="middle" class="text-small">Pool Addresses, Settings</text>
  
  <!-- Main Flow Arrows -->
  <path class="arrow" d="M 700 180 L 700 220 L 300 220 L 300 250"/>
  <path class="arrow" d="M 700 180 L 700 220 L 550 220 L 550 250"/>
  <path class="arrow" d="M 700 180 L 700 220 L 800 220 L 800 250"/>
  <path class="arrow" d="M 700 180 L 700 220 L 1050 220 L 1050 250"/>
  
  <!-- Service to Quoter Arrows -->
  <path class="arrow" d="M 250 330 L 250 370 L 190 370 L 190 400"/>
  <path class="arrow" d="M 350 330 L 350 370 L 410 370 L 410 400"/>
  
  <!-- Service to Contract Arrows -->
  <path class="arrow" d="M 550 330 L 550 520 L 700 520 L 700 550"/>
  <path class="arrow" d="M 800 330 L 800 520 L 700 520 L 700 550"/>
  
  <!-- Flash Loan Flow -->
  <path class="flash-arrow" d="M 1050 330 L 1050 550"/>
  <path class="flash-arrow" d="M 950 590 L 850 590"/>
  <path class="flash-arrow" d="M 850 600 L 950 600"/>
  
  <!-- Contract to DEX Arrows -->
  <path class="arrow" d="M 650 650 L 650 690 L 440 690 L 440 720"/>
  <path class="arrow" d="M 700 650 L 700 690 L 660 690 L 660 720"/>
  <path class="arrow" d="M 750 650 L 750 690 L 880 690 L 880 720"/>
  
  <!-- Utility Connections -->
  <path class="data-arrow" d="M 550 330 L 550 840 L 180 840 L 180 870"/>
  <path class="data-arrow" d="M 600 330 L 600 840 L 370 840 L 370 870"/>
  <path class="data-arrow" d="M 650 330 L 650 840 L 560 840 L 560 870"/>
  <path class="data-arrow" d="M 700 330 L 700 840 L 790 840 L 790 870"/>
  
  <!-- Trade Flow Legend -->
  <text x="100" y="1020" class="legend-text" style="font-weight: bold;">Trade Execution Flow:</text>
  
  <!-- Step 1 -->
  <circle cx="120" cy="1050" r="15" fill="#2563eb"/>
  <text x="118" y="1055" class="text-white" style="font-size: 11px;">1</text>
  <text x="145" y="1055" class="legend-text">Monitor prices on both DEXs (parallel quotes)</text>
  
  <!-- Step 2 -->
  <circle cx="120" cy="1090" r="15" fill="#7c3aed"/>
  <text x="118" y="1095" class="text-white" style="font-size: 11px;">2</text>
  <text x="145" y="1095" class="legend-text">Identify arbitrage opportunity (USDC→WAVAX/WBTC→USDC)</text>
  
  <!-- Step 3 -->
  <circle cx="120" cy="1130" r="15" fill="#ea580c"/>
  <text x="118" y="1135" class="text-white" style="font-size: 11px;">3</text>
  <text x="145" y="1135" class="legend-text">Request flash loan from Balancer V2 (0% fee)</text>
  
  <!-- Step 4 -->
  <circle cx="120" cy="1170" r="15" fill="#dc2626"/>
  <text x="118" y="1175" class="text-white" style="font-size: 11px;">4</text>
  <text x="145" y="1175" class="legend-text">Execute atomic swap: Buy low on DEX1, Sell high on DEX2</text>
  
  <!-- Step 5 -->
  <circle cx="120" cy="1210" r="15" fill="#059669"/>
  <text x="118" y="1215" class="text-white" style="font-size: 11px;">5</text>
  <text x="145" y="1215" class="legend-text">Repay flash loan + keep profit</text>
  
  <!-- Key Features Box -->
  <rect x="600" y="1020" width="400" height="200" fill="none" stroke="#64748b" stroke-width="1" rx="5"/>
  <text x="800" y="1045" text-anchor="middle" class="legend-text" style="font-weight: bold; font-size: 14px;">Key Features</text>
  
  <text x="620" y="1070" class="legend-text">✓ Balancer V2 Flash Loans (0% fee)</text>
  <text x="620" y="1095" class="legend-text">✓ Multi-token support (USDC, WAVAX, WBTC)</text>
  <text x="620" y="1120" class="legend-text">✓ Atomic execution (all-or-nothing)</text>
  <text x="620" y="1145" class="legend-text">✓ Parallel price fetching for speed</text>
  <text x="620" y="1170" class="legend-text">✓ Gas optimization & dynamic pricing</text>
  <text x="620" y="1195" class="legend-text">✓ Comprehensive error handling & recovery</text>
  
  <!-- Token Pairs Box -->
  <rect x="1050" y="1020" width="280" height="120" fill="none" stroke="#059669" stroke-width="1" rx="5"/>
  <text x="1190" y="1045" text-anchor="middle" class="legend-text" style="font-weight: bold; font-size: 14px;">Supported Trading Pairs</text>
  
  <text x="1070" y="1070" class="legend-text">• USDC ↔ WAVAX (Uniswap V3)</text>
  <text x="1070" y="1095" class="legend-text">• USDC ↔ WAVAX (TraderJoe V2)</text>
  <text x="1070" y="1120" class="legend-text">• USDC ↔ WBTC (Uniswap V3)</text>
  <text x="1070" y="1145" class="legend-text">• USDC ↔ WBTC (TraderJoe V2)</text>
  
  <!-- Arrow Legend -->
  <text x="100" y="1280" class="legend-text" style="font-weight: bold;">Arrow Types:</text>
  <line x1="100" y1="1305" x2="150" y2="1305" class="arrow"/>
  <text x="160" y="1310" class="legend-text">Main execution flow</text>
  
  <line x1="100" y1="1330" x2="150" y2="1330" class="flash-arrow"/>
  <text x="160" y="1335" class="legend-text">Flash loan flow</text>
  
  <line x1="100" y1="1355" x2="150" y2="1355" class="data-arrow"/>
  <text x="160" y="1360" class="legend-text">Data/utility connections</text>
  
  <!-- Status Indicators -->
  <rect x="600" y="1280" width="400" height="100" fill="#f0fdf4" stroke="#16a34a" stroke-width="2" rx="5"/>
  <text x="800" y="1305" text-anchor="middle" style="font-weight: bold; font-size: 14px; fill: #16a34a;">System Status</text>
  <text x="620" y="1330" style="fill: #16a34a;" class="legend-text">✅ Phase 1.6: WBTC Integration Complete</text>
  <text x="620" y="1355" style="fill: #16a34a;" class="legend-text">✅ Balancer V2 Flash Loans Active</text>
  
  <!-- Performance Metrics Box -->
  <rect x="1050" y="1180" width="280" height="120" fill="#fef3c7" stroke="#f59e0b" stroke-width="1" rx="5"/>
  <text x="1190" y="1205" text-anchor="middle" class="legend-text" style="font-weight: bold; font-size: 14px;">Performance Optimizations</text>
  <text x="1070" y="1230" class="legend-text">• Gas-optimized contract &lt;24KB</text>
  <text x="1070" y="1255" class="legend-text">• Parallel quote fetching</text>
  <text x="1070" y="1280" class="legend-text">• Cached gas prices (10s TTL)</text>
</svg>